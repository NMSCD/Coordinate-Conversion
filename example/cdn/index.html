<!doctype html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>CDN Example</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css" />
    <link rel="stylesheet" href="./atom-one-dark.min.css" />
    <script type="text/javascript" async src="./highlight.min.js"></script>

    <!-- TODO make use of the remote file when the Github pages for the repo is set up -->
    <script type="text/javascript" async src="./coordinate-conversion.umd.cjs"></script>


    <style>
        .noselect {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .help-text {
            position: absolute;
        }

        .ta-center {
            text-align: center;
        }

        fieldset {
            position: relative;
            margin: 0;
        }
    </style>
</head>

<body>
    <header class="container noselect" style="padding-top: 3em">
        <hgroup>
            <h1>NMSCD - Coordinate Converter</h1>
            <i>How to use the library from the CDN</i>
        </hgroup>
    </header>

    <hr />

    <main class="container" style="padding-bottom: 10em">
        <section id="code">
            <h2 class="noselect">Import from CDN</h2>
            <pre><code class="language-html">&lt;script type="text/javascript" src="https://nmscd.com/Coordinate-Conversion/bundle.js"&gt;&lt;/script&gt;</code></pre>

            <h4 class="noselect">Using the converter</h4>
            <p class="noselect">With the import above, done correctly, you will be able to use the functions the library
                provides</p>
            <pre><code class="language-javascript">const galacticConversionResult = nmscdCoordinateConversion.PortalCode({ code: '023456123456' }).toGalacticCoordinates();
if (galacticConversionResult.isSuccess === true) {
    console.log(galacticConversionResult.value); // 0C55:00D5:0922:0234
}
else {
    console.warn(galacticConversionResult.errorMessage); // e.g. "Invalid portal code provided"
}</code></pre>
        </section>

        <section id="examples" class="noselect" style="padding-top: 3em">
            <h2>Example conversions</h2>

            <br />
            <form>
                <div class="grid">
                    <fieldset>
                        <label for="portal">Portal coordinates</label>
                        <input id="portal" type="text" name="portal" placeholder="023456123456" oninput="onPortalCode()"
                            value="023456123456" />
                        <small class="help-text"><i>Valid characters are 0123456789ABCDEF.</i></small>
                    </fieldset>
                    <fieldset>
                        <label for="galactic">Galactic coordinates</label>
                        <input id="portaltoGalacticCoordinates" type="text" name="galactic"
                            placeholder="0C55:00D5:0922:0234" oninput="this.value = this.placeholder" />
                    </fieldset>
                </div>
                <div class="grid">
                    <fieldset>
                    </fieldset>
                    <fieldset>
                        <label for="voxel">Voxel coordinates</label>
                        <input id="portaltoVoxel" type="text" name="voxel" placeholder="tbd"
                            oninput="this.value = this.placeholder" />
                    </fieldset>
                </div>
            </form>

            <br />
            <form>
                <div class="grid">
                    <fieldset>
                        <label for="galactic">Galactic coordinates</label>
                        <input id="galactic" type="text" name="galactic" placeholder="0A32:00D5:0F44:0234"
                            oninput="onGalacticCoord()" value="0A32:00D5:0F44:0234" />
                        <small class="help-text"><i>Valid characters are 0123456789ABCDEF with semicolons.</i></small>
                    </fieldset>
                    <fieldset>
                        <label for="portal">Portal coordinates</label>
                        <input id="galactictoGlyph" type="text" name="portal" placeholder="023456123456"
                            oninput="this.value = this.placeholder" />
                    </fieldset>
                </div>
                <div class="grid">
                    <fieldset>
                    </fieldset>
                    <fieldset>
                        <label for="voxel">Voxel coordinates</label>
                        <input id="galactictoVoxel" type="text" name="voxel" placeholder="tbd"
                            oninput="this.value = this.placeholder" />
                    </fieldset>
                </div>
            </form>

            <br />
            <form>
                <div class="grid">
                    <fieldset>
                        <label for="voxel">Voxel coordinates</label>
                        <input id="voxel" type="text" name="voxel" oninput="onVoxelCoord()" placeholder="tbd" />
                        <small class="help-text"><i>This input takes in an object representing a voxel
                                coordinate.</i></small>
                    </fieldset>
                    <fieldset>
                        <label for="portal">Portal coordinates</label>
                        <input id="voxeltoGlyph" type="text" name="portal" placeholder="023456123456"
                            oninput="this.value = this.placeholder" />
                    </fieldset>
                </div>
                <div class="grid">
                    <fieldset>
                    </fieldset>
                    <fieldset>
                        <label for="galactic">Galactic coordinates</label>
                        <input id="voxeltoGalacticCoordinates" type="text" name="galactic"
                            placeholder="0C55:00D5:0922:0234" oninput="this.value = this.placeholder" />
                    </fieldset>
                </div>
            </form>
        </section>
    </main>
</body>
<script defer>
    hljs.highlightAll();

    const voxelObj = { "voxelX": 563, "voxelY": 86, "voxelZ": 1861, "solarSystemIndex": 5, "planetIndex": 1 };
    const portalToVoxElem = document.getElementById('portaltoVoxel');
    portalToVoxElem.placeholder = JSON.stringify(voxelObj, null, ' ');

    const galacticToVoxelElem = document.getElementById('galactictoVoxel');
    galacticToVoxelElem.placeholder = JSON.stringify(voxelObj, null, ' ');

    const voxelElem = document.getElementById('voxel');
    voxelElem.placeholder = JSON.stringify(voxelObj, null, ' ');
    voxelElem.value = JSON.stringify(voxelObj, null, ' ');

    function onInputChange(
        id,
        disableInputValidation,
        createConverter,
        ...methodsToCall
    ) {
        const ref = document.getElementById(id);
        const helpTextElem = document.querySelector(`#${id}+.help-text`);
        let converter;

        try {
            converter = createConverter(ref.value);
        }
        catch (ex) {
            helpTextElem.innerText = ex?.toString?.();
            ref.ariaInvalid = (disableInputValidation === true) ? undefined : true;
            return;
        }

        for (const methodToCallObj of methodsToCall) {
            try {
                const convertResult = converter[methodToCallObj.method]?.();
                if (convertResult.isSuccess === false) {
                    helpTextElem.innerText = convertResult.errorMessage;
                    ref.ariaInvalid = (disableInputValidation === true) ? undefined : true;
                    return;
                }

                const resultElem = document.getElementById(`${id}${methodToCallObj.method}`);
                if (resultElem != null) {
                    const newValue = methodToCallObj.toValue(convertResult.value)
                    resultElem.value = newValue;
                    resultElem.placeholder = newValue;
                }
            }
            catch (ex) {
                helpTextElem.innerText = ex?.toString?.();
                ref.ariaInvalid = (disableInputValidation === true) ? undefined : true;
                return;
            }
        }

        helpTextElem.innerText = '';
        ref.ariaInvalid = (disableInputValidation === true) ? undefined : false;
    }

    function onPortalCode(disableInputValidation) {
        onInputChange(
            'portal',
            disableInputValidation,
            (portalCode) => nmscdCoordinateConversion.PortalCode({ code: portalCode }),
            {
                method: 'toGalacticCoordinates',
                toValue: (galacticValue) => galacticValue.code,
            },
            {
                method: 'toVoxel',
                toValue: (voxelValue) => JSON.stringify(voxelValue, null, ' '),
            },
        );
    }

    function onGalacticCoord(disableInputValidation) {
        onInputChange(
            'galactic',
            disableInputValidation,
            (galacticCoord) => nmscdCoordinateConversion.GalacticCoordinate({ code: galacticCoord }),
            {
                method: 'toGlyph',
                toValue: (glyphValue) => glyphValue.code,
            },
            {
                method: 'toVoxel',
                toValue: (voxelValue) => JSON.stringify(voxelValue, null, ' '),
            },
        );
    }

    function onVoxelCoord(disableInputValidation) {
        onInputChange(
            'voxel',
            disableInputValidation,
            (voxelCoord) => {
                return nmscdCoordinateConversion.VoxelCoordinate(JSON.parse(voxelCoord));
            },
            {
                method: 'toGlyph',
                toValue: (glyphValue) => glyphValue.code,
            },
            {
                method: 'toGalacticCoordinates',
                toValue: (galacticValue) => galacticValue.code,
            },
        );
    }

    onPortalCode(true);
    onGalacticCoord(true);
    onVoxelCoord(true);
</script>

</html>